(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{574:function(t,e,_){"use strict";_.r(e);var v=_(3),a=Object(v.a)({},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("div",{staticClass:"content"},[t._m(0),_("h3",[t._v("Note")]),t._v("\n裡面有些相關的 "),_("code",[t._v("port")]),t._v(" 防火牆有設定的話記得要開啟。"),_("p"),t._v(" "),_("h2",[t._v("Zabbix Server")]),_("br"),t._v(" "),_("h3",[t._v("環境")]),t._v(" "),t._m(1),t._v(" "),_("br"),t._v(" "),_("h3",[t._v("事前已準備(略過安裝流程)")]),t._v(" "),t._m(2),t._v(" "),_("br"),t._v(" "),_("h3",[t._v("安裝 zabbix-java-gateway")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("package download install")]),t._v(" "),t._m(3),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v("\n      tar -xzvf zabbix-4.0.3.tar.gz\n      cd zabbix-4.0.3\n      ./configure --prefix=/usr/local/zabbix_java_gateway --enable-java\n      make\n      make install\n  ")])],1)]),t._v(" "),_("br"),t._v(" "),_("ul",[_("li",[_("p",[t._v("npm install")]),t._v(" "),t._m(4),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v("\n      yum install zabbix-java-gateway-4.0.3-1.el7.x86_64.rpm\n  ")])],1)]),t._v(" "),_("br"),t._v(" "),_("h3",[t._v("文件配置")]),t._v(" "),t._m(5),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v("\n    vim /etc/zabbix/zabbix_java_gateway.conf\n")]),t._v(" "),_("br"),t._v(" "),t._m(6),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v('\n    LISTEN_IP="0.0.0.0"\n    LISTEN_PORT=10052\n    PID_FILE="/var/run/zabbix/zabbix_java.pid"\n    START_POLLERS=5\n')]),t._v(" "),_("br"),t._v(" "),t._m(7),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v("\n    systemctl restart zabbix-java-gateway\n")]),t._v(" "),_("br"),t._v(" "),t._m(8),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v("\n    vim /etc/zabbix/zabbix_server.conf\n")]),t._v(" "),_("br"),t._v(" "),t._m(9),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v("\n    JavaGateway=172.16.7.14 # your zabbix server IP\n    LISTEN_PORT=10052 # default setting port\n    StartJavaPollers=5 # default is zero\n")]),t._v(" "),_("br"),t._v(" "),t._m(10),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v("\n    systemctl restart zabbix-server\n")]),t._v(" "),_("br"),_("br"),t._v(" "),_("h2",[t._v("Tomcat Client")]),_("br"),t._v(" "),_("h3",[t._v("環境")]),t._v(" "),t._m(11),t._v(" "),_("br"),t._v(" "),_("h3",[t._v("事前已準備(略過安裝流程)")]),t._v(" "),t._m(12),t._v(" "),_("br"),t._v(" "),_("h3",[t._v("重要事項")]),t._v(" "),t._m(13),t._v(" "),_("br"),t._v(" "),_("h3",[t._v("文件配置")]),t._v(" "),t._m(14),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v('\n    # add JMX param\n    CATALINA_OPTS="$CATALINA_OPTS\n    -Dcom.sun.management.jmxremote\n    -Dcom.sun.management.jmxremote.port=12346\n    -Dcom.sun.management.jmxremote.ssl=false\n    -Dcom.sun.management.jmxremote.authenticate=false\n    -Djava.rmi.server.hostname=172.16.4.182" # your tomcat server IP\n')]),t._v(" "),_("br"),t._v(" "),t._m(15),t._v(" "),_("br"),t._v(" "),_("highlight-code",{attrs:{slot:"codeText",lang:"bash"},slot:"codeText"},[t._v("\n    ./shutdown.sh\n    ./startup.sh\n")]),t._v(" "),_("br"),_("br"),t._v(" "),_("h2",[t._v("Zabbix Server Web")]),t._v(" "),_("ol",[_("li",[t._m(16),_("div",{staticClass:"post-img"},[_("img",{attrs:{src:t.$withBase("/images/zabbix-jmx/1.jpg")}})]),_("p")]),t._v(" "),_("li",[t._m(17),_("div",{staticClass:"post-img"},[_("img",{attrs:{src:t.$withBase("/images/zabbix-jmx/2.jpg")}})]),_("p")]),t._v(" "),_("li",[t._m(18),_("div",{staticClass:"post-img"},[_("img",{attrs:{src:t.$withBase("/images/zabbix-jmx/3.jpg")}})]),_("p")]),t._v(" "),_("li",[t._m(19),_("div",{staticClass:"post-img"},[_("img",{attrs:{src:t.$withBase("/images/zabbix-jmx/4.jpg")}})]),_("p")]),t._v(" "),_("li",[t._m(20),_("div",{staticClass:"post-img"},[_("img",{attrs:{src:t.$withBase("/images/zabbix-jmx/5.jpg")}})]),t._v(" "),_("div",{staticClass:"post-img"},[_("img",{attrs:{src:t.$withBase("/images/zabbix-jmx/6.jpg")}})]),_("p")])]),t._v(" "),_("h3",[t._v("Future")]),t._v(" "),t._m(21)],1)},[function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("p",[t._v("最近因為某些事情要嘗試利用 "),_("code",[t._v("Zabbix")]),t._v(" 去監控多個硬體和虛擬機，並針對監控的內容抓取寫進資料庫的資料來做一些像是 "),_("code",[t._v("Line")]),t._v(" 的訊息推撥，而當中也想到 "),_("code",[t._v("Zabbix")]),t._v(" 也可以使用 "),_("code",[t._v("zabbix-java-gateway")]),t._v(" 去監控像 "),_("code",[t._v("tomcat")]),t._v(" 這樣的資源，所以就來安裝玩看看，以下的步驟會分為 "),_("code",[t._v("zabbix server")]),t._v(" 端和 "),_("code",[t._v("tomcat client")]),t._v(" 的方式。\n")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Cent OS 7")]),this._v(" "),e("li",[this._v("OpenJDK 1.8.0_191")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("zabbix 4.0.3")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[e("a",{attrs:{href:"https://www.zabbix.com/download_sources"}},[this._v("前往官方")]),this._v(" 下載 source 包")]),this._v(" "),e("li",[this._v("安裝 (使用編譯安裝編譯時要加上 "),e("code",[this._v("--enable-java")]),this._v(")")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("yum install package")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("修改 "),e("code",[this._v("zabbix_java_gateway.conf")]),this._v(" 設定")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("使用設定檔內以下幾個基本參數")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[this._v("重啟 "),e("code",[this._v("zabbix-java-gateway")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"4"}},[e("li",[this._v("修改 "),e("code",[this._v("zabbix_server.conf")]),this._v(" 設定")])])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ol",{attrs:{start:"5"}},[_("li",[t._v("修改設定內參數，而最重要的 "),_("code",[t._v("StartJavaPollers")]),t._v(" 探測器一定要打開並且不要使用預設值 "),_("code",[t._v("0")]),t._v("，這邊範例使用 "),_("code",[t._v("5")]),t._v("，不然 "),_("code",[t._v("Zabbix Server")]),t._v(" 的網頁會因為你沒打開他不會去要東西而不會亮綠燈，這也是我搞了好久才發現的...")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"6"}},[e("li",[this._v("重啟 "),e("code",[this._v("zabbix-server")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Cent OS 7")]),this._v(" "),e("li",[this._v("OpenJDK 1.8.0_191")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Tomcat 9")]),this._v(" "),e("li",[this._v("zabbix agent")])])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ul",[_("li",[_("p",[t._v("網路資源較少提到其實要先下載兩個 "),_("code",[t._v("jar")]),t._v(" 檔來讓 "),_("code",[t._v("zabbix-java-gateway")]),t._v(" 來呼叫從而利用 "),_("code",[t._v("jar")]),t._v(" 檔中的 "),_("code",[t._v("method")]),t._v(" 來取得需要監控的項目")]),t._v(" "),_("ol",[_("li",[_("a",{attrs:{href:"https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.0.M8/bin/extras/catalina-jmx-remote.jar"}},[_("code",[t._v("catalina-jmx-remote.jar")]),t._v(" 點我下載")]),t._v("，這個要去官網對應的 "),_("code",[t._v("tomcat")]),t._v(" 版本的底下的 "),_("code",[t._v("bin")]),t._v(" 拉下來在丟到你的 "),_("code",[t._v("tomcat lib path")]),t._v("，他的檔案透過網頁方式去搜尋到對應的版本然後選擇 "),_("code",[t._v("bin/extras")]),t._v(" 後才會看到")]),t._v(" "),_("li",[_("a",{attrs:{href:"http://crawler.archive.org/cmdline-jmxclient/cmdline-jmxclient-0.10.3.jar/"}},[_("code",[t._v("cmdline-jmxclient-0.10.3.jar")]),t._v(" 點我下載")]),t._v("，目前已經有 "),_("code",[t._v("0.10.4")]),t._v(" version，多了一個 "),_("code",[t._v("attributes command")])]),t._v(" "),_("li",[t._v("將上述兩包 "),_("code",[t._v("jar")]),t._v(" 檔放入 "),_("code",[t._v("tomcat lib")]),t._v(" 內")])])])])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ol",[_("li",[t._v("修改 "),_("code",[t._v("tomact")]),t._v(" 的 "),_("code",[t._v("catalina.sh")]),t._v(" 設定上加上 "),_("code",[t._v("JMX")]),t._v(" 的參數在 "),_("code",[t._v("CATALINA_OPTS")]),t._v("，我將讓 "),_("code",[t._v("zabbix-java-gateway")]),t._v(" 可監聽的 "),_("code",[t._v("port")]),t._v(" 設為 "),_("code",[t._v("12346")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("重啟 "),e("code",[this._v("tomcat")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("login admin")]),this._v(" > "),e("code",[this._v("Configuration")]),this._v(" > "),e("code",[this._v("Hosts")]),this._v(" > "),e("code",[this._v("Create host")])])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("p",[_("code",[t._v("Host name")]),t._v(" \b為 "),_("code",[t._v("tomcat IP")]),t._v(", "),_("code",[t._v("Visiable name")]),t._v(" 為要在列表顯示的名稱，"),_("code",[t._v("Groups")]),t._v(" 我是先選 "),_("code",[t._v("Zabbix servers")]),t._v("，而主要是要加入 "),_("code",[t._v("JMX interfaces")]),t._v(", "),_("code",[t._v("IP")]),t._v(" 一樣為 "),_("code",[t._v("tomcat IP")]),t._v(" 而 "),_("code",[t._v("port")]),t._v(" 為剛剛所設在 "),_("code",[t._v("catalina.sh")]),t._v(" 裡的 "),_("code",[t._v("12346")]),t._v("，最後按下 "),_("code",[t._v("update")])])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("p",[t._v("跳到上面的 "),_("code",[t._v("Templates")]),t._v("，並在 "),_("code",[t._v("Linked templates")]),t._v(" 加入 "),_("code",[t._v("Template App Apache Tomcat JMX")]),t._v(" 以及 "),_("code",[t._v("Template App Generic Java JMX")]),t._v("，然後按下 "),_("code",[t._v("update")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("回到 "),e("code",[this._v("Hosts")]),this._v(" 頁面觀看列表，可以發現 "),e("code",[this._v("Tomcat9")]),this._v(" 的 "),e("code",[this._v("JMX")]),this._v(" 亮起了綠燈\n")])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("p",[t._v("點進 "),_("code",[t._v("Tomcat9")]),t._v(" 的 "),_("code",[t._v("Application")]),t._v("，我們可以看一下基本 "),_("code",[t._v("JMX")]),t._v(" 到底可以監聽哪些事情，例如 "),_("code",[t._v("Memory")]),t._v(" ...等等，當然要看更細項的東西可以點選最右邊的 "),_("code",[t._v("items")])])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("p",[t._v("之後會動手實際放一包有和 "),_("code",[t._v("DB")]),t._v(" 連結的 "),_("code",[t._v("war")]),t._v(" ，來利用 "),_("code",[t._v("zabbix")]),t._v(" 監控整個專案的使用 "),_("code",[t._v("DB")]),t._v(" 的情況再來撰寫一篇做記錄。")])}],!1,null,null,null);a.options.__file="tomcat9-install-jmx-with-zabbix.md";e.default=a.exports}}]);